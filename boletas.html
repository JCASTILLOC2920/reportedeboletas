<!DOCTYPE html>
<html lang="es">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JC PATH LAB - Generador de Boletas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/dexie@3.2.2/dist/dexie.js"></script>
    <style>
        /* Estilos existentes (sin cambios) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a3a5f;
            --secondary: #2c5d8c;
            --accent: #3a86b8;
            --light: #f8f9fa;
            --dark: #0d1b2a;
            --text: #333333;
            --border: #e0e0e0;
            --success: #4caf50;
            --hover: #2a7cc7;
            --light-blue: #3a86b8;
            --pending: #e74c3c;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text);
            display: flex;
            min-height: 100vh;
        }

        /* Header Styles - MODIFICADO para menú lateral */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 250px;
            flex-shrink: 0;
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }

        .header-container {
            display: flex;
            flex-direction: column;
            padding: 1rem 0;
            height: auto;
        }

        .logo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 1rem;
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, var(--accent), #4a9bd9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .logo i {
            font-size: 36px;
            color: white;
        }

        .title {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .title span {
            display: block;
            font-size: 0.85rem;
            font-weight: 400;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Navigation Styles - MODIFICADO para menú lateral */
        nav {
            width: 100%;
        }

        .nav-menu {
            display: flex;
            flex-direction: column;
            list-style: none;
            padding: 0;
            width: 100%;
        }

        .nav-menu li {
            margin: 0;
            position: relative;
            width: 100%;
        }

        .nav-menu li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            padding: 1rem 1.5rem;
            display: block;
            transition: all 0.3s ease;
            position: relative;
            width: 100%;
        }

        .nav-menu li a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #cce6ff;
        }

        .nav-menu li a::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: white;
            transition: height 0.3s ease;
            opacity: 0;
        }

        .nav-menu li a:hover::after,
        .nav-menu li a.active::after {
            opacity: 1;
            height: 100%;
        }

        /* Hamburger Menu - OCULTO en desktop, visible en móvil */
        .hamburger {
            display: none;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
        }

        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: var(--primary);
            margin: 5px auto;
            transition: all 0.3s ease;
        }

        /* Contenido principal */
        .main-content {
            flex: 1;
            margin-left: 250px;
            width: calc(100% - 250px);
        }

        /* Responsive Styles */
        @media (max-width: 860px) {
            body {
                flex-direction: column;
            }
            
            header {
                width: 100%;
                height: auto;
                position: relative;
                padding: 0;
            }
            
            .header-container {
                height: 70px;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 0 1rem;
            }
            
            .logo-section {
                flex-direction: row;
                padding: 0;
                margin-bottom: 0;
            }
            
            .logo {
                width: 50px;
                height: 50px;
                margin-right: 10px;
                margin-bottom: 0;
            }
            
            .title {
                font-size: 1rem;
            }
            
            .title span {
                font-size: 0.75rem;
            }
            
            .nav-menu {
                position: fixed;
                top: 0;
                left: -100%;
                width: 280px;
                height: 100vh;
                background: linear-gradient(135deg, var(--primary), var(--dark));
                flex-direction: column;
                padding: 100px 0 30px 0;
                transition: all 0.5s ease;
                z-index: 1000;
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.15);
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-menu li {
                margin: 0;
            }
            
            .nav-menu li a {
                font-size: 1.1rem;
                padding: 1rem 2rem;
            }
            
            .hamburger {
                display: block;
            }
            
            .hamburger.active span:nth-child(1) {
                transform: translateY(8px) rotate(45deg);
            }
            
            .hamburger.active span:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger.active span:nth-child(3) {
                transform: translateY(-8px) rotate(-45deg);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .header-container {
                padding: 0 1rem;
            }
            
            .title {
                font-size: 0.9rem;
            }
            
            .title span {
                font-size: 0.7rem;
            }
        }

        /* Demo Content */
        .content {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 2rem;
            text-align: center;
        }
        
        .content h1 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
        }
        
        .content p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #555;
            max-width: 800px;
            margin: 0 auto 2rem;
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
        }
        
        .feature-card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            width: 280px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .feature-card i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }
        
        .feature-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Nueva funcionalidad: Secciones */
        .page-section {
            display: none;
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 2rem;
        }
        
        .page-section.active {
            display: block;
        }
        
        .section-title {
            color: var(--primary);
            margin-bottom: 2rem;
            font-size: 2.2rem;
            text-align: center;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
            display: inline-block;
        }
        
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 2.5rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 1.8rem;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(58, 134, 184, 0.2);
        }
        
        .form-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.8rem;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .btn {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.9rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            text-align: left;
            padding: 1rem;
            font-weight: 600;
        }
        
        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        tr:hover {
            background-color: #f0f7ff;
        }
        
        /* Contenedor A4 para impresión */
        .a4-container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            position: relative;
            padding: 15mm;
            box-sizing: border-box;
        }

        /* Estilos específicos para la plantilla de boleta */
        .template-preview {
            background: white;
            border-radius: 0;
            padding: 0;
            border: 1px solid var(--border);
            min-height: 267mm;
            position: relative;
        }
        
        .template-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10mm 15mm;
            text-align: center;
            margin: -15mm -15mm 5mm -15mm;
        }
        
        .template-body {
            padding: 5mm 0;
        }
        
        .template-row {
            display: flex;
            border-bottom: 1px dashed var(--border);
            padding: 5px 0;
            margin-bottom: 3mm;
        }
        
        .template-label {
            flex: 0 0 40%;
            font-weight: 600;
            color: var(--dark);
        }
        
        .template-value {
            flex: 1;
        }
        
        /* Estilo para el nuevo título de boleta (color cambiado a azul) */
        .boleta-title {
            font-family: Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            text-decoration: underline;
            margin: 10mm 0 5mm 0;
            color: var(--light-blue);
            text-align: center;
        }
        
        /* Nuevo estilo para la fecha y ubicación */
        .location-date {
            position: absolute;
            bottom: 15mm;
            right: 15mm;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        /* Estilos para los campos de costo */
        .costo-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        
        .costo-item {
            margin-bottom: 10px;
        }
        
        .total-container {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            font-weight: bold;
            text-align: right;
            border-left: 4px solid var(--accent);
        }
        
        /* Estilos para impresión */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .a4-container,
            .a4-container * {
                visibility: visible;
            }
            
            .a4-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 210mm;
                height: 297mm;
                margin: 0;
                padding: 15mm;
                box-shadow: none;
                page-break-after: always;
            }
            
            .template-header {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            .no-print {
                display: none !important;
            }
        }
        
        /* Nuevos estilos para el registro de boletas */
        .boleta-pending {
            border-bottom: 2px solid var(--pending) !important;
        }
        
        .cancelado-cell {
            text-align: center;
        }
        
        .delete-boleta {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 5px;
        }
        
        .delete-boleta:hover {
            background-color: #c0392b;
        }
        
        .print-boleta {
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .print-boleta:hover {
            background-color: var(--secondary);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
        }

        /* Paginación */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .pagination-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .pagination-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .page-info {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
    </style>
</head>
<body style="overflow: auto;">
    <header>
        <div class="header-container">
            <div class="logo-section" id="logoSection">
                <div class="logo">
                    <i class="fas fa-microscope"></i>
                </div>
                <div class="title">
                    JC PATH LAB
                    <span>Generador de Boletas de Laboratorio de Anatomía Patológica</span>
                </div>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="registro">Registro de cliente</a></li>
                    <li><a href="#" class="nav-link" data-section="listado">Listado de clientes</a></li>
                    <li><a href="#" class="nav-link" data-section="plantilla">Plantilla de boleta</a></li>
                    <!-- Nuevo elemento de menú para Registro de Boletas -->
                    <li><a href="#" class="nav-link" data-section="registro-boletas">Registro de boletas</a></li>
                    <!-- Elemento "Volver" ELIMINADO según solicitud -->
                </ul>
                <button class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <div class="main-content">
        <!-- Sección de Inicio (existente) -->
        <section class="content" id="inicio" style="display: none;">
            <h1>Sistema de Gestión de Laboratorio de Anatomía Patológica</h1>
            <p>JC PATH LAB ofrece soluciones avanzadas para la generación de boletas de laboratorio, gestión de clientes y seguimiento de muestras patológicas con los más altos estándares de calidad.</p>
            
            <div class="features">
                <div class="feature-card">
                    <i class="fas fa-user-plus"></i>
                    <h3>Registro de Clientes</h3>
                    <p>Gestión completa de información de clientes y pacientes con historial de muestras.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-list-alt"></i>
                    <h3>Listado de Clientes</h3>
                    <p>Acceso rápido a todos los clientes registrados dengan opciones de búsqueda avanzada.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-file-medical"></i>
                    <h3>Plantillas de Boletas</h3>
                    <p>Generación profesional de boletas con diseños personalizables y datos precisos.</p>
                </div>
                <!-- Nueva tarjeta de características -->
                <div class="feature-card">
                    <i class="fas fa-receipt"></i>
                    <h3>Registro de Boletas</h3>
                    <p>Gestión permanente de boletas generadas con seguimiento de pagos y estado.</p>
                </div>
                <!-- Nueva tarjeta de características para Usuarios del Sistema -->
                <div class="feature-card">
                    <i class="fas fa-users"></i>
                    <h3>Usuarios del Sistema</h3>
                    <p>Gestión de usuarios y permisos del sistema administrativo.</p>
                </div>
            </div>
        </section>

        <!-- Sección de Registro de Cliente - Modificada -->
        <section class="page-section" id="registro" style="display: block;">
            <div class="form-container">
                <h2 class="section-title">Registro de Cliente</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="razon-social">Razón Social</label>
                        <input type="text" id="razon-social" placeholder="Ingrese razón social">
                    </div>
                    
                    <div class="form-group">
                        <label for="ruc">RUC</label>
                        <input type="text" id="ruc" placeholder="Número de RUC">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="direccion">Dirección</label>
                        <input type="text" id="direccion" placeholder="Dirección completa">
                    </div>
                    
                    <div class="form-group">
                        <label for="telefono">Teléfono</label>
                        <input type="text" id="telefono" placeholder="Número de teléfono">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Correo electrónico">
                </div>
                
                <button class="btn btn-block" id="registrar-cliente">Registrar Cliente</button>
            </div>
        </section>

        <!-- Sección de Listado de Clientes - Modificada -->
        <section class="page-section" id="listado" style="display: none;">
            <div class="table-container">
                <h2 class="section-title">Listado de Clientes</h2>
                
                <table id="clientes-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Razón Social</th>
                            <th>RUC</th>
                            <th>Dirección</th>
                            <th>Teléfono</th>
                            <th>Email</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="clientes-body"></tbody>
                </table>
                
                <!-- Paginación para clientes -->
                <div class="pagination" id="clientes-pagination">
                    <button class="pagination-btn" id="prev-clientes" disabled>Anterior</button>
                    <div class="page-info">Página <span id="clientes-page">1</span></div>
                    <button class="pagination-btn" id="next-clientes">Siguiente</button>
                </div>
            </div>
        </section>

        <!-- Sección de Plantilla de Boleta - Modificada -->
        <section class="page-section" id="plantilla" style="display: none;">
            <div class="a4-container">
                <div class="template-preview">
                    <div class="template-header">
                        <h2>JC PATH LAB</h2>
                        <p>Laboratorio de Anatomía Patológica</p>
                    </div>
                    <div class="boleta-title">BOLETA DE VENTA</div>
                    
                    <div class="template-body">
                        <!-- Datos del emisor (permanentes) -->
                        <div class="template-row">
                            <div class="template-label">EMISOR:</div>
                            <div class="template-value"></div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">NOMBRE:</div>
                            <div class="template-value">Josehp Christopher Castillo Cuenca</div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">DOCUMENTO:</div>
                            <div class="template-value">DNI 41457466</div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">DIRECCIÓN:</div>
                            <div class="template-value">MZ M2 LOTE 13 URB. JARDINES DE CHILLON</div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">RUC Emisor:</div>
                            <div class="template-value">10414574667</div>
                        </div>
                        
                        <!-- Separador visual -->
                        <div class="template-row" style="border-bottom: 2px solid var(--border); margin: 10mm 0;"></div>
                        
                        <!-- Nuevo título CLIENTE -->
                        <div class="template-row">
                            <div class="template-label" style="font-size: 1.2em; color: var(--primary);">CLIENTE:</div>
                            <div class="template-value"></div>
                        </div>
                        
                        <!-- Campos del cliente -->
                        <div class="template-row">
                            <div class="template-label">Razón Social:</div>
                            <div class="template-value">
                                <select id="cliente-select" class="costo-input"><option value="">Seleccione un cliente</option></select>
                            </div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">RUC:</div>
                            <div class="template-value" id="ruc-cliente"></div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">Dirección:</div>
                            <div class="template-value" id="direccion-cliente"></div>
                        </div>
                        
                        <div class="template-row">
                            <div class="template-label">Número de muestras:</div>
                            <div class="template-value">
                                <input type="number" id="num-muestras" min="1" value="1" class="costo-input">
                            </div>
                        </div>
                        
                        <div id="costos-container"><div class="template-row costo-item">
                            <div class="template-label">Muestra 1 Costo:</div>
                            <div class="template-value">
                                <input type="number" class="costo-input costo-muestra" min="0" step="0.01" placeholder="S/ 0.00" data-index="1">
                            </div>
                        </div></div>
                        
                        <div class="total-container">
                            <div class="template-label">Pago total:</div>
                            <div class="template-value" id="pago-total">S/ 0.00</div>
                        </div>
                    </div>
                    
                    <!-- Ubicación y fecha movidas a la derecha -->
                    <div class="location-date">Puente Piedra, <span id="current-date">17 de agosto de 2025</span></div>
                </div>
            </div>
            
            <!-- Botón de impresión - MODIFICADO: Cambiado a "Generar Boleta" -->
            <div class="no-print" style="text-align: center; margin-top: 20px;">
                <!-- Nuevo botón para guardar boleta -->
                <button class="btn" id="guardar-boleta" style="margin-right: 10px;">
                    <i class="fas fa-save"></i> Guardar Boleta
                </button>
                <button class="btn" onclick="window.print()">
                    <i class="fas fa-print"></i> Generar Boleta
                </button>
            </div>
        </section>
        
        <!-- Nueva sección para Registro de Boletas -->
        <section class="page-section" id="registro-boletas" style="display: none;">
            <div class="table-container">
                <h2 class="section-title">Registro de Boletas</h2>
                <p class="section-description" style="text-align: center; margin-bottom: 20px; color: #555;">
                    Este registro permanece permanente y solo puede ser eliminado por el administrador
                </p>
                
                <table id="boletas-table">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Razón Social</th>
                            <th>RUC</th>
                            <th>Dirección</th>
                            <th>N° Muestras</th>
                            <th>Monto</th>
                            <th>Cancelado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="boletas-body"></tbody>
                </table>
                
                <!-- Paginación para boletas -->
                <div class="pagination" id="boletas-pagination">
                    <button class="pagination-btn" id="prev-boletas" disabled>Anterior</button>
                    <div class="page-info">Página <span id="boletas-page">1</span></div>
                    <button class="pagination-btn" id="next-boletas">Siguiente</button>
                </div>
            </div>
        </section>

        <!-- Nueva sección para Usuarios del Sistema -->
        <section class="page-section" id="usuarios-sistema" style="display: none;">
            <div class="form-container">
                <h2 class="section-title">Usuarios del Sistema</h2>
                <p style="text-align: center; margin-bottom: 30px;">
                    Gestión de usuarios y permisos del sistema administrativo
                </p>
                
                <div class="form-group">
                    <label for="nombre-usuario">Nombre de Usuario</label>
                    <input type="text" id="nombre-usuario" placeholder="Ingrese nombre de usuario">
                </div>
                
                <div class="form-group">
                    <label for="email-usuario">Email</label>
                    <input type="email" id="email-usuario" placeholder="Correo electrónico del usuario">
                </div>
                
                <div class="form-group">
                    <label for="rol-usuario">Rol</label>
                    <select id="rol-usuario" class="costo-input">
                        <option value="">Seleccione un rol</option>
                        <option value="administrador">Administrador</option>
                        <option value="usuario">Usuario</option>
                        <option value="consulta">Consulta</option>
                    </select>
                </div>
                
                <button class="btn btn-block" id="guardar-usuario">Guardar Usuario</button>
            </div>
        </section>
    </div>

    <script>
        // Configuración de IndexedDB con Dexie
        const db = new Dexie('LaboratorioDB');
        db.version(1).stores({
            clientes: '++id, razonSocial, ruc, direccion, telefono, email, createdAt',
            boletas: '++id, codigo, razonSocial, ruc, direccion, numMuestras, montos, total, cancelado, fecha'
        });
        
        // Variables para paginación
        const PAGE_SIZE = 10;
        let currentClientPage = 1;
        let currentBoletaPage = 1;
        let totalClientPages = 1;
        let totalBoletaPages = 1;
        
        // Precarga de datos críticos
        async function precargarDatos() {
            try {
                // Precargar clientes
                const countClientes = await db.clientes.count();
                totalClientPages = Math.ceil(countClientes / PAGE_SIZE);
                
                // Precargar boletas
                const countBoletas = await db.boletas.count();
                totalBoletaPages = Math.ceil(countBoletas / PAGE_SIZE);
                
                // Actualizar paginación
                updatePagination('clientes');
                updatePagination('boletas');
                
                // Precargar datos iniciales
                renderClientesTable();
                renderBoletasTable();
                populateClientSelect();
            } catch (error) {
                console.error('Error en precarga de datos:', error);
            }
        }
        
        // Escuchador de cambios en tiempo real
        function setupDatabaseListeners() {
            // Escuchar cambios en clientes
            db.clientes.hook('creating', function(primKey, obj, transaction) {
                setTimeout(() => {
                    renderClientesTable();
                    populateClientSelect();
                }, 100);
            });
            
            db.clientes.hook('updating', function(mods, primKey, obj, transaction) {
                setTimeout(() => {
                    renderClientesTable();
                    populateClientSelect();
                }, 100);
            });
            
            db.clientes.hook('deleting', function(primKey, obj, transaction) {
                setTimeout(() => {
                    renderClientesTable();
                    populateClientSelect();
                }, 100);
            });
            
            // Escuchar cambios en boletas
            db.boletas.hook('creating', function(primKey, obj, transaction) {
                setTimeout(() => {
                    renderBoletasTable();
                }, 100);
            });
            
            db.boletas.hook('updating', function(mods, primKey, obj, transaction) {
                setTimeout(() => {
                    renderBoletasTable();
                }, 100);
            });
            
            db.boletas.hook('deleting', function(primKey, obj, transaction) {
                setTimeout(() => {
                    renderBoletasTable();
                }, 100);
            }
            );
        }
        
        // Mobile menu toggle functionality
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');
        
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
            
            // Toggle body scroll when menu is open
            if (navMenu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = 'auto';
            }
        });
        
        // Nueva funcionalidad: Navegación entre secciones
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar base de datos
            precargarDatos();
            setupDatabaseListeners();
            
            // Elementos de navegación
            const navLinks = document.querySelectorAll('.nav-link');
            const logoSection = document.getElementById('logoSection');
            
            // Secciones
            const inicioSection = document.getElementById('inicio');
            const registroSection = document.getElementById('registro');
            const listadoSection = document.getElementById('listado');
            const plantillaSection = document.getElementById('plantilla');
            const registroBoletasSection = document.getElementById('registro-boletas');
            const usuariosSistemaSection = document.getElementById('usuarios-sistema');
            
            // Función para mostrar una sección específica
            function showSection(sectionId) {
                // Ocultar todas las secciones
                inicioSection.style.display = 'none';
                registroSection.style.display = 'none';
                listadoSection.style.display = 'none';
                plantillaSection.style.display = 'none';
                registroBoletasSection.style.display = 'none';
                usuariosSistemaSection.style.display = 'none';
                
                // Mostrar la sección solicitada
                document.getElementById(sectionId).style.display = 'block';
                
                // Actualizar clase activa en navegación
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.section === sectionId) {
                        link.classList.add('active');
                    }
                });
                
                // Cerrar menú móvil si está abierto
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
                document.body.style.overflow = 'auto';
                
                // Si es la sección de plantilla, poblar clientes
                if (sectionId === 'plantilla') {
                    populateClientSelect();
                }
                
                // Si es la sección de listado, actualizar tabla
                if (sectionId === 'listado') {
                    renderClientesTable();
                }
                
                // Si es la sección de registro de boletas, actualizar tabla
                if (sectionId === 'registro-boletas') {
                    renderBoletasTable();
                }
            }
            
            // Event listeners para los enlaces de navegación
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Si el enlace no tiene data-section (como el enlace "Volver"), no hacer nada especial
                    if (!this.dataset.section) return;
                    
                    e.preventDefault();
                    showSection(this.dataset.section);
                });
            });
            
            // Event listener para el logo (volver a inicio)
            logoSection.addEventListener('click', function() {
                showSection('inicio');
            });
            
            // Funcionalidad para eliminar filas de clientes
            document.getElementById('clientes-body').addEventListener('click', async function(e) {
                if (e.target.classList.contains('eliminar-btn')) {
                    const row = e.target.closest('tr');
                    const id = parseInt(row.getAttribute('data-id'));
                    
                    if (confirm('¿Está seguro que desea eliminar este cliente?')) {
                        try {
                            await db.clientes.delete(id);
                            // La eliminación se manejará automáticamente por el listener
                        } catch (error) {
                            alert('Error al eliminar cliente: ' + error);
                        }
                    }
                }
            });
            
            // Registrar nuevo cliente
            document.getElementById('registrar-cliente').addEventListener('click', async function() {
                const razonSocial = document.getElementById('razon-social').value;
                const ruc = document.getElementById('ruc').value;
                const direccion = document.getElementById('direccion').value;
                const telefono = document.getElementById('telefono').value;
                const email = document.getElementById('email').value;
                
                if (!razonSocial || !ruc || !direccion) {
                    alert('Por favor complete los campos requeridos (Razón Social, RUC y Dirección)');
                    return;
                }
                
                try {
                    await db.clientes.add({
                        razonSocial,
                        ruc,
                        direccion,
                        telefono: telefono || '',
                        email: email || '',
                        createdAt: new Date()
                    });
                    
                    // Limpiar formulario
                    document.getElementById('razon-social').value = '';
                    document.getElementById('ruc').value = '';
                    document.getElementById('direccion').value = '';
                    document.getElementById('telefono').value = '';
                    document.getElementById('email').value = '';
                    
                    alert('Cliente registrado exitosamente');
                    showSection('listado');
                } catch (error) {
                    alert('Error al registrar cliente: ' + error);
                }
            });
            
            // Función para generar código de boleta
            function generarCodigoBoleta() {
                const currentYear = new Date().getFullYear();
                const codigo = `${currentYear}-${new Date().getTime().toString().slice(-5)}`;
                return codigo;
            }
          
            // Código para reemplazar el evento del botón "Generar Boleta"
            document.querySelector('.btn[onclick="window.print()"]').onclick = null;
            document.querySelector('.btn[onclick="window.print()"]').addEventListener('click', function() {
                const clienteSelect = document.getElementById('cliente-select');
                const selectedOption = clienteSelect.options[clienteSelect.selectedIndex];
                
                if (!selectedOption.value) {
                    alert('Por favor seleccione un cliente');
                    return;
                }
                
                const razonSocial = selectedOption.textContent;
                const ruc = selectedOption.getAttribute('data-ruc') || '';
                const direccion = selectedOption.getAttribute('data-direccion') || '';
                const numMuestras = parseInt(document.getElementById('num-muestras').value) || 1;
                
                // Obtener costos de muestras
                const montos = [];
                let total = 0;
                
                document.querySelectorAll('.costo-muestra').forEach(input => {
                    const monto = parseFloat(input.value) || 0;
                    montos.push(monto);
                    total += monto;
                });
                
                // Generar código de boleta
                const codigo = generarCodigoBoleta();
                
                // Redirigir a reporteboleta.html con los parámetros
                const params = new URLSearchParams({
                    razonSocial: encodeURIComponent(razonSocial),
                    ruc: encodeURIComponent(ruc),
                    direccion: encodeURIComponent(direccion),
                    numMuestras: numMuestras,
                    total: total,
                    codigo: codigo
                });
                
                window.location.href = `reporteboleta.html?${params.toString()}`;
            });

            // Guardar nueva boleta - MODIFICADO: No redirige, se queda en la misma sección
            document.getElementById('guardar-boleta').addEventListener('click', async function() {
                const clienteSelect = document.getElementById('cliente-select');
                const selectedOption = clienteSelect.options[clienteSelect.selectedIndex];
                
                if (!selectedOption.value) {
                    alert('Por favor seleccione un cliente');
                    return;
                }
                
                const razonSocial = selectedOption.textContent;
                const ruc = selectedOption.getAttribute('data-ruc') || '';
                const direccion = selectedOption.getAttribute('data-direccion') || '';
                const numMuestras = parseInt(document.getElementById('num-muestras').value) || 1;
                
                // Obtener costos de muestras
                const montos = [];
                let total = 0;
                
                document.querySelectorAll('.costo-muestra').forEach(input => {
                    const monto = parseFloat(input.value) || 0;
                    montos.push(monto);
                    total += monto;
                });
                
                try {
                    await db.boletas.add({
                        codigo: generarCodigoBoleta(),
                        razonSocial,
                        ruc,
                        direccion,
                        numMuestras,
                        montos,
                        total,
                        cancelado: false,
                        fecha: new Date().toISOString()
                    });
                    
                    alert('Boleta registrada exitosamente');
                    
                    // Limpiar el formulario
                    document.getElementById('cliente-select').selectedIndex = 0;
                    document.getElementById('ruc-cliente').textContent = '';
                    document.getElementById('direccion-cliente').textContent = '';
                    document.getElementById('num-muestras').value = 1;
                    // Disparar el evento change para regenerar los campos de costo
                    document.getElementById('num-muestras').dispatchEvent(new Event('change'));
                    document.getElementById('pago-total').textContent = 'S/ 0.00';
                    
                } catch (error) {
                    alert('Error al guardar boleta: ' + error);
                }
            });
            
            // Renderizar tabla de boletas con paginación
            async function renderBoletasTable() {
                const tbody = document.getElementById('boletas-body');
                tbody.innerHTML = '';
                
                try {
                    const offset = (currentBoletaPage - 1) * PAGE_SIZE;
                    const boletas = await db.boletas
                        .orderBy('fecha')
                        .reverse()
                        .offset(offset)
                        .limit(PAGE_SIZE)
                        .toArray();
                    
                    if (boletas.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td colspan="8" style="text-align: center;">No hay boletas registradas</td>`;
                        tbody.appendChild(row);
                        return;
                    }
                    
                    boletas.forEach(boleta => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', boleta.id);
                        
                        if (!boleta.cancelado) {
                            row.classList.add('boleta-pending');
                        }
                        
                        row.innerHTML = `
                            <td>${boleta.codigo}</td>
                            <td>${boleta.razonSocial}</td>
                            <td>${boleta.ruc}</td>
                            <td>${boleta.direccion}</td>
                            <td>${boleta.numMuestras}</td>
                            <td>S/ ${boleta.total.toFixed(2)}</td>
                            <td class="cancelado-cell">
                                <input type="checkbox" ${boleta.cancelado ? 'checked' : ''} 
                                       class="cancelado-checkbox" data-id="${boleta.id}">
                            </td>
                            <td class="action-buttons">
                                <button class="print-boleta" data-id="${boleta.id}">
                                    <i class="fas fa-print"></i> Imprimir
                                </button>
                                <button class="delete-boleta" data-id="${boleta.id}">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } catch (error) {
                    console.error('Error al cargar boletas:', error);
                }
            }
            
            // Evento para cambiar estado de cancelación
            document.getElementById('boletas-body').addEventListener('change', async function(e) {
                if (e.target.classList.contains('cancelado-checkbox')) {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    const checked = e.target.checked;
                    
                    try {
                        await db.boletas.update(id, { cancelado: checked });
                        
                        const row = e.target.closest('tr');
                        if (checked) {
                            row.classList.remove('boleta-pending');
                        } else {
                            row.classList.add('boleta-pending');
                        }
                    } catch (error) {
                    }
                }
            });
            
            // Evento para eliminar boleta
            document.getElementById('boletas-body').addEventListener('click', async function(e) {
                if (e.target.classList.contains('delete-boleta') || 
                    e.target.closest('.delete-boleta')) {
                    const btn = e.target.classList.contains('delete-boleta') 
                        ? e.target 
                        : e.target.closest('.delete-boleta');
                    const id = parseInt(btn.getAttribute('data-id'));
                    
                    if (confirm('¿Está seguro que desea eliminar esta boleta? Esta acción no se puede deshacer.')) {
                        try {
                            await db.boletas.delete(id);
                            // La eliminación se manejará automáticamente por el listener
                        } catch (error) {
                            alert('Error al eliminar boleta: ' + error);
                        }
                    }
                }
                
                // Evento para imprimir boleta
                if (e.target.classList.contains('print-boleta') || 
                    e.target.closest('.print-boleta')) {
                    const btn = e.target.classList.contains('print-boleta') 
                        ? e.target 
                        : e.target.closest('.print-boleta');
                    const id = parseInt(btn.getAttribute('data-id'));
                    imprimirBoleta(id);
                }
            });
            
            // Función para imprimir una boleta específica
            async function imprimirBoleta(id) {
                try {
                    const boleta = await db.boletas.get(id);
                    if (!boleta) return;
                    
                    // Crear un nuevo contenedor para la impresión
                    const printContainer = document.createElement('div');
                    printContainer.className = 'a4-container';
                    printContainer.innerHTML = `
                        <div class="template-preview">
                            <div class="template-header">
                                <h2>JC PATH LAB</h2>
                                <p>Laboratorio de Anatomía Patológica</p>
                            </div>
                            <div class="boleta-title">BOLETA DE VENTA</div>
                            
                            <div class="template-body">
                                <div class="template-row">
                                    <div class="template-label">EMISOR:</div>
                                    <div class="template-value"></div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">NOMBRE:</div>
                                    <div class="template-value">Josehp Christopher Castillo Cuenca</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">DOCUMENTO:</div>
                                    <div class="template-value">DNI 41457466</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">DIRECCIÓN:</div>
                                    <div class="template-value">MZ M2 LOTE 13 URB. JARDINES DE CHILLON</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">RUC Emisor:</div>
                                    <div class="template-value">10414574667</div>
                                </div>
                                
                                <div class="template-row" style="border-bottom: 2px solid var(--border); margin: 10mm 0;"></div>
                                
                                <div class="template-row">
                                    <div class="template-label" style="font-size: 1.2em; color: var(--primary);">CLIENTE:</div>
                                    <div class="template-value"></div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">Razón Social:</div>
                                    <div class="template-value">${boleta.razonSocial}</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">RUC:</div>
                                    <div class="template-value">${boleta.ruc}</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">Dirección:</div>
                                    <div class="template-value">${boleta.direccion}</div>
                                </div>
                                
                                <div class="template-row">
                                    <div class="template-label">Número de muestras:</div>
                                    <div class="template-value">${boleta.numMuestras}</div>
                                </div>
                                
                                <div id="costos-container">
                                    ${boleta.montos.map((monto, index) => `
                                        <div class="template-row costo-item">
                                            <div class="template-label">Muestra ${index + 1} Costo:</div>
                                            <div class="template-value">S/ ${monto.toFixed(2)}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="total-container">
                                    <div class="template-label">Pago total:</div>
                                    <div class="template-value">S/ ${boleta.total.toFixed(2)}</div>
                                </div>
                            </div>
                            
                            <div class="location-date">Puente Piedra, ${formatDate(new Date(boleta.fecha))}</div>
                        </div>
                    `;
                    
                    // Agregar al cuerpo del documento
                    document.body.appendChild(printContainer);
                    
                    // Imprimir
                    window.print();
                    
                    // Eliminar el contenedor después de imprimir
                    setTimeout(() => {
                        document.body.removeChild(printContainer);
                    }, 100);
                } catch (error) {
                    alert('Error al cargar boleta: ' + error);
                }
            }
            
            // Función para formatear fecha
            function formatDate(date) {
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                return date.toLocaleDateString('es-ES', options);
            }
            
            // Actualizar paginación
            async function updatePagination(type) {
                try {
                    let count, currentPage, totalPages, pageElement;
                    
                    if (type === 'clientes') {
                        count = await db.clientes.count();
                        totalPages = Math.ceil(count / PAGE_SIZE);
                        currentPage = currentClientPage;
                        pageElement = document.getElementById('clientes-page');
                        document.getElementById('prev-clientes').disabled = currentPage <= 1;
                        document.getElementById('next-clientes').disabled = currentPage >= totalPages;
                    } else {
                        count = await db.boletas.count();
                        totalPages = Math.ceil(count / PAGE_SIZE);
                        currentPage = currentBoletaPage;
                        pageElement = document.getElementById('boletas-page');
                        document.getElementById('prev-boletas').disabled = currentPage <= 1;
                        document.getElementById('next-boletas').disabled = currentPage >= totalPages;
                    }
                    
                    pageElement.textContent = currentPage;
                } catch (error) {
                    console.error('Error al actualizar paginación:', error);
                }
            }
            
            // Mostrar sección de inicio por defecto
            showSection('inicio');
            
            // Función para formatear la fecha actual
            function formatCurrentDate() {
                const now = new Date();
                return formatDate(now);
            }
            
            // Actualizar la fecha en la plantilla de boleta
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                dateElement.textContent = formatCurrentDate();
            }
            
            // Poblar select de clientes
            async function populateClientSelect() {
                const select = document.getElementById('cliente-select');
                
                // Limpiar select
                select.innerHTML = '<option value="">Seleccione un cliente</option>';
                
                try {
                    const clientes = await db.clientes.toArray();
                    
                    clientes.forEach(cliente => {
                        const option = document.createElement('option');
                        option.value = cliente.id;
                        option.textContent = cliente.razonSocial;
                        option.setAttribute('data-ruc', cliente.ruc);
                        option.setAttribute('data-direccion', cliente.direccion);
                        select.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error al cargar clientes:', error);
                }
            }
            
            // Renderizar tabla de clientes con paginación
            async function renderClientesTable() {
                const tbody = document.getElementById('clientes-body');
                tbody.innerHTML = '';
                
                try {
                    const offset = (currentClientPage - 1) * PAGE_SIZE;
                    const clientes = await db.clientes
                        .orderBy('createdAt')
                        .reverse()
                        .offset(offset)
                        .limit(PAGE_SIZE)
                        .toArray();
                    
                    if (clientes.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td colspan="7" style="text-align: center;">No hay clientes registrados</td>`;
                        tbody.appendChild(row);
                        return;
                    }
                    
                    clientes.forEach(cliente => {
                        const row = document.createElement('tr');
                        row.setAttribute('data-id', cliente.id);
                        row.innerHTML = `
                            <td>${cliente.id}</td>
                            <td>${cliente.razonSocial}</td>
                            <td>${cliente.ruc}</td>
                            <td>${cliente.direccion}</td>
                            <td>${cliente.telefono}</td>
                            <td>${cliente.email}</td>
                            <td>
                                <button class="btn eliminar-btn">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    // Actualizar paginación
                    await updatePagination('clientes');
                } catch (error) {
                    console.error('Error al cargar clientes:', error);
                }
            }
            
            // Evento para selección de cliente
            document.getElementById('cliente-select').addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                document.getElementById('ruc-cliente').textContent = selectedOption.getAttribute('data-ruc') || '';
                document.getElementById('direccion-cliente').textContent = selectedOption.getAttribute('data-direccion') || '';
            });
            
            // Generar campos de costo dinámicamente
            document.getElementById('num-muestras').addEventListener('change', function() {
                const numMuestras = parseInt(this.value) || 1;
                const container = document.getElementById('costos-container');
                container.innerHTML = '';
                
                for (let i = 1; i <= numMuestras; i++) {
                    const div = document.createElement('div');
                    div.className = 'template-row costo-item';
                    div.innerHTML = `
                        <div class="template-label">Muestra ${i} Costo:</div>
                        <div class="template-value">
                            <input type="number" class="costo-input costo-muestra" min="0" step="0.01" placeholder="S/ 0.00" data-index="${i}">
                        </div>
                    `;
                    container.appendChild(div);
                }
                
                // Agregar eventos a los nuevos campos
                document.querySelectorAll('.costo-muestra').forEach(input => {
                    input.addEventListener('input', calcularTotal);
                });
            });
            
            // Calcular total
            function calcularTotal() {
                let total = 0;
                document.querySelectorAll('.costo-muestra').forEach(input => {
                    total += parseFloat(input.value) || 0;
                });
                document.getElementById('pago-total').textContent = `S/ ${total.toFixed(2)}`;
            }
            
            // Inicializar campos de costo
            document.getElementById('num-muestras').dispatchEvent(new Event('change'));
            
            // Eventos de paginación
            document.getElementById('prev-clientes').addEventListener('click', async function() {
                if (currentClientPage > 1) {
                    currentClientPage--;
                    await renderClientesTable();
                }
            });
            
            document.getElementById('next-clientes').addEventListener('click', async function() {
                const count = await db.clientes.count();
                const totalPages = Math.ceil(count / PAGE_SIZE);
                
                if (currentClientPage < totalPages) {
                    currentClientPage++;
                    await renderClientesTable();
                }
            });
            
            document.getElementById('prev-boletas').addEventListener('click', async function() {
                if (currentBoletaPage > 1) {
                    currentBoletaPage--;
                    await renderBoletasTable();
                }
            });
            
            document.getElementById('next-boletas').addEventListener('click', async function() {
                const count = await db.boletas.count();
                const totalPages = Math.ceil(count / PAGE_SIZE);
                
                if (currentBoletaPage < totalPages) {
                    currentBoletaPage++;
                    await renderBoletasTable();
                }
            });
        });
    </script>
</body>
</html>